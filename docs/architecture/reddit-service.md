# Reddit Integration (Enhanced)

**–°—Ç–∞—Ç—É—Å:** Production (Stable)
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Sidecar Proxy Pattern
**–õ–æ–≥–∏–∫–∞:** AI Scout v2 (Intent Plans) + Context-Aware Ranking
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 10.02.2026

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Sidecar Proxy)

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ Reddit —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

```mermaid
graph LR
    User[User Query] --> Backend[FastAPI Backend]
    Backend -- "1. Translate (RU->EN)" --> Translation[Translation Service]
    Translation -- "2. Generate Plan" --> Scout[ü§ñ AI Scout v2 (Gemini 3 Flash)]
    
    Scout -- "Intent Queries + Keywords" --> Proxy[Reddit Proxy Service]
    
    Proxy -- "MCP Tool (Depth 3)" --> Reddit[Reddit API]
    Reddit --> Proxy
    Proxy -- "Sanitized JSON" --> Backend
    Backend -- "3. Semantic Ranking" --> Ranker[Context-Aware Ranker]
    Ranker -- "Top 15 Posts" --> Gemini[Synthesis Model]
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1.  **Backend (`RedditEnhancedService`)**:
    *   **ü§ñ AI Scout v2:** –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤, Gemini 3 —Å–æ–∑–¥–∞–µ—Ç **–ü–ª–∞–Ω –ü–æ–∏—Å–∫–∞** (Search Plan):
        *   `Subreddits`: –¶–µ–ª–µ–≤—ã–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `LocalLLaMA`).
        *   `Intent Queries`: 3-5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Ñ—Ä–∞–∑ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"Claude Code" config.json setup`).
        *   `Keywords`: –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Skills`, `CLI`).
    *   **Context-Aware Ranking:**
        *   **No Time Decay:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≥–∞–π–¥—ã (—Ñ–ª–∞–≥ `is_technical_guide`) –Ω–µ —Ç–µ—Ä—è—é—Ç —Ä–µ–π—Ç–∏–Ω–≥ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º.
        *   **Semantic Boost:** –ü–æ—Å—Ç—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ, –ø–æ–ª—É—á–∞—é—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å Score –¥–æ **x3.0**.
    *   **Deep Fetch:** –î–ª—è —Ç–æ–ø-–ø–æ—Å—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `/details` —ç–Ω–¥–ø–æ–∏–Ω—Ç—É –ø—Ä–æ–∫—Å–∏. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –∏ –¥–µ—Ä–µ–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (Depth 3, Limit 50).
    *   **üõ°Ô∏è Authority Signals:**
        *   **Flair Detection:** –°–∏—Å—Ç–µ–º–∞ –≤–∏–¥–∏—Ç –ø–ª–∞—à–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`Maintainer`, `Dev`) –∏ –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ –Ω–∏–º.
        *   **OP Verification:** –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä –ø–æ—Å—Ç–∞ (OP) –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ ("Thanks, it worked!"), —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `[‚úÖ OP VERIFIED SOLUTION]`.
        *   **Score Skepticism:** LLM –∏–Ω—Å—Ç—Ä—É–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –≤—ã—Å–æ–∫–æ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è (—Ñ–∏–ª—å—Ç—Ä —à—É—Ç–æ–∫).

2.  **Proxy (`services/reddit-proxy`)**:
    *   Node.js + Fastify –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å.
    *   **Endpoints:**
        *   `POST /search` - –ü–æ–∏—Å–∫ –ø–æ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–∞–º.
        *   `POST /details` - –¢–æ—á–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç MCP –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö.
    *   **Code Preservation:** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π **–Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç** –±–ª–æ–∫–∏ –∫–æ–¥–∞ (` ``` `), —Å–æ—Ö—Ä–∞–Ω—è—è –æ—Ç—Å—Ç—É–ø—ã –≤ Python/YAML –∫–æ–Ω—Ñ–∏–≥–∞—Ö.
    *   **Data Integrity:** –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ–≥–æ –¥–µ—Ä–µ–≤–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ Zalgo, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è).

3.  **Synthesis (`RedditSynthesisService`)**:
    *   **Fact-Maxing:** –ü—Ä–æ–º–ø—Ç –∂–µ—Å—Ç–∫–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —ç–º–æ—Ü–∏–∏ ("Amazing!") –∏ –∏—â–µ—Ç —Ü–∏—Ñ—Ä—ã/–±–µ–Ω—á–º–∞—Ä–∫–∏.
    *   **Inverted Pyramid:** –û—Ç–≤–µ—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ —Å—Ö–µ–º–µ "–†–µ—à–µ–Ω–∏–µ -> –î–µ—Ç–∞–ª–∏ -> –°–ø–æ—Ä—ã".

---

## üß† –õ–æ–≥–∏–∫–∞ "AI Scout v2" (Intent Planning)

–í–º–µ—Å—Ç–æ regex-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (`OR`), –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Ñ—Ä–∞–∑.

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:
**–ó–∞–ø—Ä–æ—Å:** "–∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∫–∏–ª–ª—ã –≤ Claude Code?"

**Scout v2 Plan:**
1.  **Subreddits:** `ClaudeAI`, `Anthropic`, `coding`
2.  **Intent Queries:**
    *   `"Claude Code" skills workflow guide`
    *   `"Claude Code" MCP config.json`
    *   `"Claude Code" custom tools setup`
3.  **Keywords:** `["Skills", "Config", "MCP"]`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≥–∞–π–¥—ã –∏ –∫–æ–Ω—Ñ–∏–≥–∏, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ Claude.

---

## üìä Semantic Ranking Strategy

–ö–∞–∫ –º—ã –≤—ã–±–∏—Ä–∞–µ–º –ª—É—á—à–µ–µ –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ?

1.  **Base Score:** `(Upvotes + Comments * 2)`
2.  **Technical Guide Detection:** –ï—Å–ª–∏ –ø–æ—Å—Ç –Ω–∞–π–¥–µ–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π `ai_intent` –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Ä–∫–µ—Ä—ã "Guide/Tutorial" -> –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `is_technical_guide`.
3.  **Keyword Boost:** –ï—Å–ª–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –µ—Å—Ç—å —Å–ª–æ–≤–∞ –∏–∑ `Keywords` (Scout) -> Score —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ **1.5 - 3.0**.
4.  **Time Decay (–£–º–Ω—ã–π):**
    *   –î–ª—è **–ù–æ–≤–æ—Å—Ç–µ–π**: –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è" (Hacker News), —à—Ç—Ä–∞—Ñ—É—é—â–∞—è –∑–∞ –≤–æ–∑—Ä–∞—Å—Ç.
    *   –î–ª—è **–ì–∞–π–¥–æ–≤**: Decay **–û–¢–ö–õ–Æ–ß–ï–ù**. –°—Ç–∞—Ä—ã–π, –Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π –≥–∞–π–¥ —Å 2000 –ª–∞–π–∫–æ–≤ –±—É–¥–µ—Ç –≤—ã—à–µ —Å–≤–µ–∂–µ–π –Ω–æ–≤–æ—Å—Ç–∏ —Å 500 –ª–∞–π–∫–∞–º–∏.

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã
- **Backend Service:** `backend/src/services/reddit_enhanced_service.py` (Scout Logic & Ranking)
- **Proxy Service:** `services/reddit-proxy/src/index.ts` (Sanitization Logic)

### Proxy API
```http
POST https://experts-reddit-proxy.fly.dev/search
Content-Type: application/json

{
  "query": "Claude Code skills guide",
  "subreddits": ["ClaudeAI"], 
  "limit": 25,
  "sort": "relevance"
}
```

---

## üöÄ Deployment

- **Backend:** –î–µ–ø–ª–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ `backend/`.
- **Proxy:** –î–µ–ø–ª–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ `services/reddit-proxy/`.
# Reddit Integration (Enhanced)

**–°—Ç–∞—Ç—É—Å:** Production (Stable)
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Sidecar Proxy Pattern
**–õ–æ–≥–∏–∫–∞:** Smart Targeting + Deep Tree Analysis
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 07.02.2026

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Sidecar Proxy)

–°–∏—Å—Ç–µ–º–∞ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Reddit API –∏–∑ –±—ç–∫–µ–Ω–¥–∞ (–∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ IP –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–æ–≤). –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å-–ø—Ä–æ–∫—Å–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

```mermaid
graph LR
    User[User Query] --> Backend[FastAPI Backend]
    Backend -- "1. Translate (RU->EN)" --> Translation[Translation Service]
    Translation --> Logic{Topic Detection}
    
    Logic -- "Topic Found (AI/Dev)" --> Targeted[Strict Targeted Search]
    Logic -- "No Topic" --> Global[Global Search]
    
    Targeted -- "HTTP JSON" --> Proxy[Reddit Proxy Service]
    Global -- "HTTP JSON" --> Proxy
    
    Proxy -- "MCP Tool (Depth 3, Limit 50)" --> Reddit[Reddit API]
    Reddit --> Proxy
    Proxy --> Backend
    Backend -- "Inverted Pyramid Synthesis" --> Gemini[Gemini 3 Flash]
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1.  **Backend (`RedditEnhancedService`)**:
    *   –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–º—É –∑–∞–ø—Ä–æ—Å–∞ (AI, LLM, Dev, PM).
    *   –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–∏—Å–∫–∞ (Strict vs Global).
    *   –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –ø—Ä–æ–∫—Å–∏.
2.  **Proxy (`services/reddit-proxy`)**:
    *   Node.js + Fastify –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å.
    *   **Round 3 Upgrade:** –ö–∞—á–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (Depth 3, Limit 50) –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –¥–∏—Å–∫—É—Å—Å–∏–π.
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç MCP (`reddit-mcp-buddy`) –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Reddit.
    *   –†–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–∏—Å–∫ –≤–Ω—É—Ç—Ä–∏ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ `search_reddit`.
3.  **Synthesis (`RedditSynthesisService`)**:
    *   **Inverted Pyramid:** –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç "–†–µ—à–µ–Ω–∏–µ -> –î–µ—Ç–∞–ª–∏ -> –°–ø–æ—Ä—ã".
    *   **Freshness:** –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É (2026) –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—å—è.
    *   **Critical Filter:** –û—Ç—Å–µ–∏–≤–∞–µ—Ç —Å–ª—É—Ö–∏ –∏ –º–µ–º—ã.

---

## üß† –õ–æ–≥–∏–∫–∞ "Smart Targeting" (Strict Mode)

–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ (Signal-to-Noise Ratio).

### 1. –î–µ—Ç–µ–∫—Ü–∏—è —Ç–µ–º—ã
–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å (–∏ –µ–≥–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–ø—Ä–∏–º–µ—Ä—ã) | –°–∞–±—Ä–µ–¥–¥–∏—Ç—ã (Target) |
|-----------|--------------------------|---------------------|
| **AI / LLM** | `hallucination`, `rag`, `embedding`, `architect`, `weights`, `prompt`, `agent` | `LocalLLaMA`, `MachineLearning`, `OpenAI`, `claudeAI`, `deeplearning` |
| **Dev** | `python`, `rust`, `code`, `engineer`, `build`, `api` | `programming`, `webdev`, `coding`, `devops`, `AskEngineers` |
| **PM** | `specs`, `jira`, `requirements`, `scrum`, `agile`, `prd` | `ProductManagement`, `projectmanagement`, `agile` |

### 2. –†–µ–∂–∏–º—ã –ø–æ–∏—Å–∫–∞ (Mutual Exclusion)

–í –∫–æ–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∂–µ—Å—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –±–æ—Ä—å–±—ã —Å —à—É–º–æ–º:

*   **üîí Strict Mode (–¢–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞):**
    *   –ü–æ–∏—Å–∫ **–¢–û–õ–¨–ö–û** –≤ —Ü–µ–ª–µ–≤—ã—Ö —Å–∞–±—Ä–µ–¥–¥–∏—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `r/LocalLLaMA`).
    *   –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (`r/all`) **–ë–õ–û–ö–ò–†–£–ï–¢–°–Ø**.
    *   *–ü—Ä–∏—á–∏–Ω–∞:* –ü–æ—Å—Ç—ã –∏–∑ `r/memes` –∏–ª–∏ `r/pics` –∏–º–µ—é—Ç —Ä–µ–π—Ç–∏–Ω–≥ 50k+ –∏ –ø—Ä–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ –≤—ã—Ç–µ—Å–Ω—è—é—Ç –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã (50-100 –ª–∞–π–∫–æ–≤). –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É.
    
*   **üåç Global Mode (–¢–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞):**
    *   –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º—É Reddit (`r/all`).
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–æ–≤–æ—Å—Ç–∏, —Å–æ–±—ã—Ç–∏—è), –≥–¥–µ –Ω–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏.

### 3. Fail-safe (Auto-detection)
–ï—Å–ª–∏ –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ (Endpoint) –∑–∞–±—ã–ª –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∞–±—Ä–µ–¥–¥–∏—Ç–æ–≤, —Å–µ—Ä–≤–∏—Å `RedditEnhancedService` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–µ—Ç–µ–∫—Ç–æ—Ä —Ç–µ–º –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ Strict Mode —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞.

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã
- **Backend Service:** `backend/src/services/reddit_enhanced_service.py`
- **Proxy Service:** `services/reddit-proxy/src/index.ts`
- **Synthesis:** `backend/src/services/reddit_synthesis_service.py`

### Proxy API
```http
POST https://experts-reddit-proxy.fly.dev/search
Content-Type: application/json

{
  "query": "How to fight hallucinations?",
  "subreddits": ["LocalLLaMA", "MachineLearning"],
  "limit": 25,
  "sort": "relevance"
}
```

### Rate Limiting & Reliability
- **Circuit Breaker:** –í—Å—Ç—Ä–æ–µ–Ω –≤ –±—ç–∫–µ–Ω–¥. –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –ø–∞–¥–∞–µ—Ç, —Å–µ—Ä–≤–∏—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–µ –ª–æ–º–∞—è –æ—Ç–≤–µ—Ç —ç–∫—Å–ø–µ—Ä—Ç–∞.
- **Timeout:** 30 —Å–µ–∫—É–Ω–¥ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è "—Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞" –ø—Ä–æ–∫—Å–∏).
- **Proxy Fix:** –ü—Ä–æ–∫—Å–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `search_reddit` (–∞ –Ω–µ `browse_subreddit`), —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤–Ω—É—Ç—Ä–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.

---

## üöÄ Deployment (CI/CD)

- **Backend:** –î–µ–ø–ª–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ `backend/`.
- **Proxy:** –î–µ–ø–ª–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ `services/reddit-proxy/` (–æ—Ç–¥–µ–ª—å–Ω—ã–π workflow `deploy-reddit-proxy.yml`).

---

## üîç Troubleshooting

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç—ã –∫–∞–∂—É—Ç—Å—è –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Lego" –≤–º–µ—Å—Ç–æ "System Architecture"):
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–≤–æ–¥:** –ë—ç–∫–µ–Ω–¥ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ EN. –ï—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –ø–ª–æ—Ö–æ–π ("building" –≤–º–µ—Å—Ç–æ "architecture"), –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –º–æ–≥—É—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å.
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:** –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –≤ `SUBREDDIT_BY_TOPIC` –∏ `topic_keywords` –≤ —Ñ–∞–π–ª–µ `reddit_enhanced_service.py`.
3. **Strict Mode:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (`Strategy 3`) –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ü–µ–ª–µ–≤—ã–º.
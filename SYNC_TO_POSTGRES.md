# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è SQLite ‚Üí PostgreSQL –¥–ª—è Railway

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `sync_to_postgres.py` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Railway.

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. **–ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ Railway** - –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –∫–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –±—ã–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL –±—ã–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã –∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL —Å–µ—Ä–≤–∏—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ Railway

–í Railway dashboard –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω PostgreSQL —Å–µ—Ä–≤–∏—Å. –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `DATABASE_URL`.

### 2. –ü–æ–ª—É—á–∏—Ç–µ DATABASE_URL –∏–∑ Railway

–í Railway dashboard:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –í—ã–±–µ—Ä–∏—Ç–µ PostgreSQL —Å–µ—Ä–≤–∏—Å
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ç–∞–± "Variables"
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `DATABASE_URL`

### 3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `data/experts.db` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
sqlite3 data/experts.db "SELECT COUNT(*) FROM posts;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
sqlite3 data/experts.db "SELECT COUNT(*) FROM comments;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å drift –∞–Ω–∞–ª–∏–∑
sqlite3 data/experts.db "SELECT COUNT(*) FROM comment_group_drift WHERE has_drift=1;"
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ DATABASE_URL
export DATABASE_URL="postgresql://user:password@host:port/dbname"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
cd backend
python sync_to_postgres.py
```

### –°–ø–æ—Å–æ–± 2: –ü—Ä—è–º–æ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ

```bash
cd backend
DATABASE_URL="postgresql://user:password@host:port/dbname" python sync_to_postgres.py
```

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ .env —Ñ–∞–π–ª

–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª:

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env
DATABASE_URL="postgresql://user:password@host:port/dbname"
SQLITE_DB_PATH="data/experts.db"
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
cd backend
python sync_to_postgres.py
```

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

### –¢–∞–±–ª–∏—Ü—ã –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è:

1. **posts** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –ø–æ—Å—Ç–∞–º–∏
2. **links** - —Å—Å—ã–ª–∫–∏ –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏
3. **comments** - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
4. **sync_state** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Telegram
5. **comment_group_drift** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã drift –∞–Ω–∞–ª–∏–∑–∞

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:

- **JSON –ø–æ–ª—è**: drift_topics –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –∏–∑ SQLite TEXT –≤ PostgreSQL JSON
- **–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL —Ç–∞–±–ª–∏—Ü—ã –æ—á–∏—â–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º (TRUNCATE CASCADE)
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–¥–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è foreign keys
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –æ—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–µ –ª—é–±–æ–π —Ç–∞–±–ª–∏—Ü—ã

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
============================================================
üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø SQLITE ‚Üí POSTGRESQL
============================================================

üîÑ –ù–∞—á–∏–Ω–∞—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é SQLite ‚Üí PostgreSQL
   –ò—Å—Ç–æ—á–Ω–∏–∫: data/experts.db
   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: railway.db.railway.app:5432/dbname

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: posts
  ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ 156 –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É posts

üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: links
  ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ 89 –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É links

üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: comments
  ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ 1245 –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É comments

üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: sync_state
  ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ 3 –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É sync_state

üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: comment_group_drift
  ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ 156 –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É comment_group_drift

üéâ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
   –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π –Ω–∞ Railway
```

## –ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–ø–ª–æ–π –Ω–∞ Railway**
   - Railway –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ health check –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   ```bash
   curl https://your-app.railway.app/health
   ```

3. **–°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å**
   ```bash
   curl -X POST https://your-app.railway.app/api/v1/query \
     -H "Content-Type: application/json" \
     -d '{"query": "–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å", "stream_progress": false}'
   ```

## Troubleshooting

### –û—à–∏–±–∫–∞: variable "DATABASE_URL" not set

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è DATABASE_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–∞.

### –û—à–∏–±–∫–∞: connection to server... failed

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ PostgreSQL —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω –≤ Railway.

### –û—à–∏–±–∫–∞: permission denied for database

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ DATABASE_URL. –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å—å.

### –û—à–∏–±–∫–∞: table "posts" does not exist

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. Railway –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ –µ—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞—è, –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã.

### –û—à–∏–±–∫–∞: column "expert_id" does not exist

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ PostgreSQL. Railway –º–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π.

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ CI/CD pipeline:

```yaml
# .github/workflows/sync-to-railway.yml
name: Sync to Railway

on:
  push:
    branches: [main]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          cd backend
          pip install -r requirements.txt

      - name: Sync to PostgreSQL
        env:
          DATABASE_URL: ${{ secrets.RAILWAY_DATABASE_URL }}
        run: |
          cd backend
          python sync_to_postgres.py
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ DATABASE_URL –≤ git** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ secrets
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ read-only –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã** –ø–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –≤ production
- **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ PostgreSQL

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

–î–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. **pg_dump/pg_restore** –¥–ª—è –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
2. **DBeaver** –∏–ª–∏ –¥—Ä—É–≥–∏–µ GUI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
3. **Railway console** –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. **Custom migration scripts** –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö
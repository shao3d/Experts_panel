# Рекомендации по дальнейшей оптимизации Resolve промпта

## Дата: 2025-09-29
## Автор: Claude (на основе анализа работы системы)

## Текущее состояние
После улучшений 29.09.2025 система показывает **2.4x улучшение** полноты ответов:
- До: 9 постов (только Map фаза)
- После: 22 поста (9 Map + 13 Resolve)

## Возможные дальнейшие улучшения

### 1. Тонкая настройка порогов уверенности

**Текущие пороги:**
- TOOL_SPECIFIC: 60%
- CONCEPT_EXPLORATION: 40%
- KNOWLEDGE_SYNTHESIS: 30%

**Рекомендация:** После сбора данных с 50+ реальных запросов рассмотреть:
- Снижение порога CONCEPT_EXPLORATION до 30-35%
- Это может дать еще 2-3 релевантных поста для концептуальных вопросов

### 2. Увеличение лимитов постов

**Текущие лимиты:**
- TOOL_SPECIFIC: 7 постов
- CONCEPT_EXPLORATION: 10 постов
- KNOWLEDGE_SYNTHESIS: 15 постов

**Рекомендация:** Для CONCEPT_EXPLORATION увеличить до 12-15 постов
- Автор часто развивает темы через 10+ постов
- Баланс между полнотой и стоимостью запроса

### 3. Добавление подтипов запросов

**Возможные подтипы:**
- TOOL_COMPARISON: Сравнение инструментов (depth=2, threshold=50%)
- HISTORICAL_OVERVIEW: Развитие темы во времени (depth=2, threshold=35%)
- PRACTICAL_EXAMPLE: Поиск примеров кода/использования (depth=1, threshold=70%)

### 4. Анализ эффективности по метрикам

**Что измерять:**
- % постов из Resolve, которые попадают в main_sources финального ответа
- Корреляция между query_type и оптимальным expand_depth
- Среднее количество "полезных" vs "шумовых" постов

### 5. Адаптация под паттерны автора

**Обнаруженные паттерны:**
- 98.9% связей - MENTION (не reply/forward)
- Посты-хабы (#ReDigest) имеют 3-5 исходящих ссылок
- Тематические серии постов обычно связаны через 2-3 недели

**Рекомендация:** Добавить специальную логику для постов-хабов:
```json
if post.outgoing_links > 3:
    importance_boost = 1.2
```

## Приоритет реализации

1. **Высокий:** Мониторинг текущей эффективности (сбор метрик)
2. **Средний:** Тонкая настройка порогов после анализа 50+ запросов
3. **Низкий:** Добавление подтипов запросов

## Важное замечание

Текущая версия промпта уже показывает отличные результаты. Дальнейшие улучшения должны быть основаны на реальных данных использования, а не на предположениях.

## Тестовые запросы для валидации

При внесении изменений обязательно протестировать:
1. "Что автор пишет про [конкретный инструмент]?" - TOOL_SPECIFIC
2. "Расскажи про [подход/методологию]" - CONCEPT_EXPLORATION
3. "Какие есть решения для [проблемы]?" - KNOWLEDGE_SYNTHESIS
4. "Сравни [инструмент A] и [инструмент B]" - будущий TOOL_COMPARISON

## Файлы для изменения

- `/backend/prompts/resolve_prompt.txt` - основной промпт
- `/backend/src/services/resolve_service.py` - логика если нужны изменения кода
